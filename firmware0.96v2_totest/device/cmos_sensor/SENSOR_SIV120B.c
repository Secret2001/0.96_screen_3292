#include "cmos_sensor.h"

#if DEV_SENSOR_SIV120B > 0
SENSOR_INIT_SECTION const unsigned char SIV120BInitTable[]= //SIV100BInitTable[][2] 
{

	0x00,0x00,
    0x04,0xc0,
    0x05,0x07, //VGA Output
    0x10,0x13,
    0x11,0x25,
    0x12,0x21,
    0x13,0x17, // ABS
    0x16,0xCF,
    0x17,0xaa, //Internal LDO On: 0xaa

    //0X20, ((HBLANK_BASE>>8)<<4)|(VBLANK_BASE>>8),  //bit[7:4] P_HBNK[11:8]  BIT[3:0] P_VBNK[11:8]
    //0X21, HBLANK_BASE & 0xff,  //bit[7:0] P_HBNK[7:0] 
    //0X22, VBLANK_BASE & 0xff,//0xa1 //0X1D //bit[7:0] P_VBNK[7:0]

    0x00,0x01,
    0x34,0x84, //step _Preview // 25FPS

    0x00,0x00,
    0x40,0x00,
    0x41,0x00,
    0x42,0x00,
    0x43,0x00,   

    0x00,0x01,
    0x11,0x0A,  // AE
    0x12,0x88,//0x80 // D65 target 0x84
    0x13,0x88,//0x80 // D30 target
    0x14,0x80, // D20 target
    0x1D,0x02, //Initial shutter time
    0x1E,0x28, //Initial analog gain
    0x40,0x7f,//0x70 // Max gain 0x7F  //68
    0x41,0x28,
    0x42,0x28,
    0x43,0x08,
    0x44,0x08,
    0x45,0x09,
    0x46,0x17,
    0x47,0x1D,
    0x48,0x21,
    0x49,0x23,
    0x4A,0x24,
    0x4B,0x26,
    0x4C,0x27,
    0x4D,0x27,
    0x4E,0x1A,
    0x4F,0x14,
    0x50,0x11,
    0x51,0x0F,
    0x52,0x0D,
    0x53,0x0C,
    0x54,0x0A,
    0x55,0x09, 
    0x60,0xFF,  // AE Window
    0x61,0xFF,
    0x62,0xFF,
    0x63,0xFF,
    0x64,0xFF,
    0x65,0xFF,
    0x66,0x00,
    0x67,0x50,
    0x68,0x50,
    0x69,0x50,
    0x6A,0x50,
    0x6B,0x00,
    0x6C,0x06,   
    0x70,0xD4, //Anti Saturation//Anti Saturation On
    0x77,0xB0,
    0x78,0xB8,
    0x79,0x6E, //Y Level 0x70 for gamma test
    0x90,0xC8,   

    0x00,0x02,
    0x10,0xD3,  // AWB
    0x11,0xC0,
    0x12,0x80,
    0x13,0x80,
    0x14,0x7F,
    0x15,0xFE,
    0x16,0x80,
    0x17,0xEA,
    0x18,0x80,
    0x19,0xB0,//0xA0
    0x1A,0x50,//0x60
    0x1B,0xB0,//0xA0
    0x1C,0x50,//0x60
    0x1D,0xA0,
    0x1E,0x70,
    0x20,0xE8,
    0x21,0x20,
    0x22,0xA4,
    0x23,0x20,
    0x24,0xFF,
    0x25,0x20,
    0x26,0x0F,
    0x27,0x10,
    0x28,0x1A,
    0x29,0xB8,
    0x2A,0x90,
    0x30,0x00,
    0x31,0x10,
    0x32,0x00,
    0x33,0x10,
    0x34,0x02,
    0x35,0x76,
    0x36,0x01,
    0x37,0xD6,
    0x40,0x01,
    0x41,0x04,
    0x42,0x08,
    0x43,0x10,
    0x44,0x12,
    0x45,0x35,
    0x46,0x64,
    0x50,0x33,
    0x51,0x20,
    0x52,0xE5,
    0x53,0xFB,
    0x54,0x13,
    0x55,0x26,
    0x56,0x07,
    0x57,0xF5,
    0x58,0xEA,
    0x59,0x21,  
    0x63,0x9D, //CMA change  -D65~A//D30 to D20 for R
    0x64,0xBE, //D30 to D20 for B
    0x65,0x9D, //D20 to D30 for R
    0x66,0xBE, //D20 to D30 for B
    0x67,0xC2, //D65 to D30 for R
    0x68,0x9C, //D65 to D30 for B
    0x69,0xC2, //D30 to D65 for R
    0x6A,0x9C, //D30 to D65 for B

    0x00,0x03,
    0x10,0xFF, // IDP// IDP function enable
    0x11,0x19,// 0x0d // PCLK polarity
    0x12,0xFD,//0XDD // Y,Cb,Cr order sequence
    0x8C,0x18, // Color matrix select at dark condition  
    0x17,0xB8,  // DPCNR
    0x18,0x18,
    0x19,0x48,
    0x1A,0x48,
    0x1B,0x3F,
    0x1C,0x10,
    0x1D,0x60,
    0x1E,0x60,
    0x1F,0x4F,
    0x20,0x03, // Normal illumiinfo start
    0x21,0x0F, // Dark illumiinfo start   
    0x30,0x00,  // Gamma
    0x31,0x08,
    0x32,0x0F,
    0x33,0x20,
    0x34,0x3B,
    0x35,0x52,
    0x36,0x66,
    0x37,0x78,
    0x38,0x89,
    0x39,0x98,
    0x3A,0xA4,
    0x3B,0xBA,
    0x3C,0xD4,
    0x3D,0xEC,
    0x3E,0xF6,
    0x3F,0xFF,   
    0x40,0x00,  // Shading
    0x41,0xDC,
    0x42,0xCB,
    0x43,0xA8,
    0x44,0x75,
    0x45,0x31,
    0x46,0x63,//0x44
    0x47,0x45,//0x63
    0x48,0x63,//0x44
    0x49,0x43,//0x62
    0x4A,0x63,//0x34
    0x4B,0x42,//0x41
    0x4C,0x52,//0x23
    0x4D,0x31,//0x40
    0x4E,0x04,
    0x4F,0x44,//0x44
    0x50,0xFE,//0xF6
    0x51,0x80,
    0x52,0x00,
    0x53,0x00,
    0x54,0x00,
    0x55,0x00,   
    0x56,0x10,  // Lowlux Shading
    0x57,0xDA,
    0x58,0xFF, 
    0x60,0x2F,    //Filter
    0x61,0xB7,
    0x62,0xB7,
    0x63,0xB7,
    0x64,0x0C,
    0x65,0xFF,
    0x66,0x08,
    0x67,0xFF,
    0x68,0x00,
    0x69,0x00,
    0x6A,0x00,
    0x6B,0x00,
    0x6C,0xA0,
    0x6D,0x10,
    0x6E,0x08,
    0x6F,0x18,   
    0x71,0x3E,  // Color Matrix (D65) - Daylight
    0x72,0xBD,
    0x73,0x05,
    0x74,0x0F,
    0x75,0x1E,
    0x76,0x13,
    0x77,0xF3,
    0x78,0xCC,
    0x79,0x41,  
    0x7A,0x3D,   // Color Matrix (D30) - CWF
    0x7B,0xC4,
    0x7C,0xFF,
    0x7D,0x10,
    0x7E,0x1D,
    0x7F,0x13,
    0x80,0xF2,
    0x81,0xC4,
    0x82,0x4A,  
    0x83,0x3C,   // Color Matrix (D20) - A
    0x84,0xC2,
    0x85,0x01,
    0x86,0x10,
    0x87,0x1F,
    0x88,0x0F,
    0x89,0xF6,
    0x8A,0xD2,
    0x8B,0x39, 
    0x90,0x20,  // Edge - Green//Up Gain
    0x91,0x40, //Down Gain
    0x92,0x04,
    0x93,0x12,
    0x94,0xFF,
    0x95,0x20,
    0x96,0x04,
    0x97,0x12,
    0x98,0xFF,
    0x99,0x20,
    0x9A,0x20,
    0x9B,0x20,
    0x9C,0x1A,
    0x9D,0x40,
    0x9E,0x00,   
    0x9F,0x38, //0X00  // Edge - Luminance
    0xA0,0x58,//0X00
    0xA1,0x01,// 0X02  
    0xA2,0x01,//0X02
    0xA3,0x04,//0X04
    0xA4,0x20,
    0xA5,0x1A,
    0xA6,0x40,
    0xA7,0x00,   
    0xA8,0x13,//0x18//0x14//0x10  // YCbCr Gain, Brightness, Contrast
    0xA9,0x10,//0X15 //a9 aa  0813
    0xAA,0x10,//0X15
    0xAB,0x04,
    0xAC,0x16,//0x12  //contrast *1/16
    0xB0,0xFF, //Y Top
    0xB1,0x00, //Y Bottom
    0xB2,0xFF,
    0xB3,0x00,
    0xB4,0xFF,
    0xB5,0x00,
    0xB6,0x00,  
    0xB9,0x1A, // Color suppress//Ilimininfo Start0 x1A
    0xBA,0x00, //0x30 //Slope   
    0xC0,0x24,  // Window
    0xC1,0x00,
    0xC2,0x80,
    0xC3,0x00,
    0xC4,0xE0,
    0xDD,0x4F, // ENHCTRL
    0xDE,0xBA, // NOIZCTRL
    0xDF,0x28,
    0xE0,0x70,
    0xE1,0x90,
    0xE2,0x08,
    0xE3,0x10,
    0xE4,0x40, 
    0xE5,0x15,   // Memory speed control
    0xE6,0x28,
    0xE7,0x04,
    0x00,0x01,
    0x10,0x80,// AE on

	  0x00,0x00,
    0x03,0xb5, //0x25 // Sensor on//0x55
-1,-1};

static void SIV120B_rotate(u32 r)
{
	unsigned char buf[2];
	buf[0] = 0x04;
	buf[1] = 0xc0|(r<<0);
//	sensor_iic_enable();
//	sensor_iic_info();		
	sensor_iic_write(buf);	

//	 sensor_iic_diable();	
}

static void SIV120B_hvblank(u32 h,u32 v)
{

	u32 i;
	const u8 t[][2] = {
		{0X20, ((h>>8)<<4)|(v>>8)},
		{0X21, h & 0xff},
		{0X22, v & 0xff},
	};
//	sensor_iic_enable();
//	sensor_iic_info();	

	for(i=0;i<6;i++)
		sensor_iic_write((u8 *)&t[i][0]);
//	 sensor_iic_diable();			
//	return (h<<16)|v;

}
SENSOR_OP_SECTION const Sensor_Op_t siv120b_cmd= 
{
	.typ = CSI_TYPE_YUV422,
	.pixelw = 640,
	.pixelh= 480,
	.hsyn = 1,
	.vsyn = 1,
	.rduline = 0,//
	.colrarray = 2, //YCBYCR
	.rotate_adapt = {0},
	.hvb_adapt = {0x6a,0x20,0x6a,0x20},
	. mclk = 24000000,
	.p_fun_adapt = {SIV120B_rotate,SIV120B_hvblank,NULL},
};

SENSOR_HEADER_ITEM_SECTION const Sensor_Init_t siv120b_init=
{
	.sensor_struct_addr =	(u32 *)&siv120b_cmd,  
	.sensor_struct_size = sizeof(Sensor_Op_t),
	.sensor_init_tab_adr =	(u32 *)SIV120BInitTable,     
	.sensor_init_tab_size = sizeof(SIV120BInitTable),
	.id               =	0x12,                 
	.w_cmd            =	0x66,                 
	.r_cmd            =	0x67,                 
	.addr_num         =	0x01,                 
	.data_num         =	0x01,                 
	.id_reg           =	0x01,                 
};



#endif
